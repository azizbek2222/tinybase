<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>HTML → GitHub Link (Telegram ID + User File)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    font-family:'Arial', sans-serif;
  }
  .box{
    width:90%;
    max-width:650px;
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(15px);
    border-radius:20px;
    padding:30px 25px;
    color:#fff;
    box-shadow:0 8px 32px rgba(0,0,0,0.25);
  }
  h2{
    text-align:center;
    margin-bottom:20px;
    font-size:24px;
    color:#00e0ff;
  }
  textarea, input{
    width:100%;
    padding:12px;
    margin-top:12px;
    border:none;
    border-radius:10px;
    font-size:14px;
    background:rgba(255,255,255,0.05);
    color:#fff;
  }
  textarea{
    height:220px;
    font-family:monospace;
    resize:vertical;
  }
  button{
    width:100%;
    margin-top:15px;
    padding:14px;
    border:none;
    border-radius:12px;
    background:#00c6ff;
    color:#000;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s;
  }
  button:hover{
    background:#00b0e6;
  }
  #out{
    margin-top:20px;
    word-break:break-all;
    font-size:14px;
  }
</style>
</head>
<body>

<div class="box">
  <h2>HTML → GitHub Pages link</h2>

  <label>HTML kodni shu yerga yoz:</label>
  <textarea id="code" placeholder="Bu yerga HTML kod yoziladi..."></textarea>

  <label>Fayl nomi (masalan: index.html):</label>
  <input id="filename" placeholder="index.html" />

  <button onclick="upload()">Link olish</button>

  <div id="out"></div>
</div>

<script>
  // GitHub konfiguratsiyasi
  const TOKEN = "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"; // Tokeningiz
  const OWNER = "azizbek2222"; // GitHub username
  const REPO = "html-test";    // GitHub repo nomi

  // Telegram mini app orqali foydalanuvchi ID olish
  const telegramUserId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;

  if(!telegramUserId){
    alert("Telegram ID topilmadi. Ilova Telegram ichida ochilishi kerak!");
  }

  async function upload(){
    if(!telegramUserId){ return; }

    const html = document.getElementById("code").value.trim();
    const filenameInput = document.getElementById("filename").value.trim();

    if(!html){ alert("HTML kodni yozing!"); return; }
    if(!filenameInput){ alert("Fayl nomini yozing!"); return; }

    const filename = `${telegramUserId}/${filenameInput}`; // Papka = Telegram ID, fayl = foydalanuvchi kiritadi

    const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${filename}`;

    // Oldingi fayl bo‘lsa SHA olish
    let sha = null;
    const check = await fetch(api, { headers:{Authorization:"token " + TOKEN}});
    if(check.ok){
      const j = await check.json();
      sha = j.sha;
    }

    // Faylni yaratish yoki yangilash
    const res = await fetch(api,{
      method:"PUT",
      headers:{
        "Authorization":"token " + TOKEN,
        "Content-Type":"application/json"
      },
      body: JSON.stringify({
        message: "Create HTML page via Telegram mini app",
        content: btoa(unescape(encodeURIComponent(html))),
        sha: sha
      })
    });

    const data = await res.json();

    if(data.content){
      const link = `https://${OWNER}.github.io/${REPO}/${telegramUserId}/${filenameInput}`;

      // Nusxalash
      const outDiv = document.getElementById("out");
      outDiv.innerHTML = `
        ✅ LINK:<br>
        <a href="${link}" target="_blank">${link}</a> <br>
        <button id="copyBtn">Nusxalash</button>
        <textarea id="tmpCopy" style="position:absolute; left:-9999px;">${link}</textarea>
      `;

      document.getElementById("copyBtn").onclick = function(){
        const tmp = document.getElementById("tmpCopy");
        tmp.select();
        tmp.setSelectionRange(0, 99999);
        document.execCommand("copy");
        alert("Link nusxalandi!");
      };

    }else{
      document.getElementById("out").innerText =
        "❌ Xatolik: " + JSON.stringify(data);
    }
  }
</script>

</body>
</html>