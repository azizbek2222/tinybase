<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>HTML Run App - Multi File Unlimited</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script>
<style>
*{box-sizing:border-box;font-family:Segoe UI,sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
/* EDITOR */
.app{
  max-width:700px;
  margin:auto;
  padding:25px;
}
input, textarea{
  width:100%;
  border-radius:12px;
  border:none;
  padding:15px;
  margin-bottom:10px;
}
textarea{
  height:160px;
}
button{
  width:100%;
  margin-top:5px;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
  background:linear-gradient(135deg,#00f260,#0575e6);
  color:#fff;
}
/* RUN PAGE */
#runResult{
  padding:20px;
}
</style>
</head>
<body>

<!-- EDITOR -->
<div id="editor" class="app">
  <h2>ðŸš€ HTML Run App - Cheksiz Fayl</h2>
  <input type="text" id="name" placeholder="Link nomini yozing (masalan: loyiham-mening)">
  <textarea id="code" placeholder="HTML kod yoki index.html yozing..."></textarea>
  <input type="file" id="files" multiple webkitdirectory directory>
  <button onclick="save()">â–¶ RUN & LINK</button>
  <p id="link"></p>
</div>

<!-- RUN NATIJA -->
<div id="runResult" style="display:none"></div>

<script>
var firebaseConfig={
  apiKey:"AIzaSyBrMKJ4MPilQg6gZsaE-Hlqlgo5F4Q8IsM",
  databaseURL:"https://xabar-tizimi-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
var db=firebase.database();

// URLdan run parameterni olish
var params=new URLSearchParams(location.search);
var runId=params.get("run");

if(runId){
  document.getElementById("editor").style.display="none";
  document.getElementById("runResult").style.display="block";

  db.ref("codes/"+runId).once("value").then(snap=>{
    document.getElementById("runResult").innerHTML=snap.val();
  });
}

function save(){
  var name = document.getElementById("name").value.trim();
  if(!name){
    alert("Iltimos link uchun nom yozing!");
    return;
  }

  var files = document.getElementById("files").files;
  if(files.length === 0){
    // Faqat textarea kodi
    var codeArea = document.getElementById("code").value;
    saveSingleFile(name, codeArea);
  } else {
    // Har bir fayl alohida saqlansin
    for(let i=0;i<files.length;i++){
      let file = files[i];
      let reader = new FileReader();
      reader.onload = function(e){
        let ext = file.name.split('.').pop().toLowerCase();
        let codeContent = e.target.result;

        // Har bir fayl uchun alohida Firebase yozish
        saveSingleFile(file.name.replace(/\.[^/.]+$/,""), codeContent);
      }
      reader.readAsText(file);
    }
  }
}

function saveSingleFile(name, code){
  var randomStr = Math.random().toString(36).substring(2,8);
  var uniqueId = name + "-" + randomStr;

  db.ref("codes/"+uniqueId).set(code);

  var link = location.origin + location.pathname + "?run=" + encodeURIComponent(uniqueId);
  var linkEl = document.createElement("p");
  linkEl.innerHTML = `<b>${name}</b> uchun link: <a href="${link}" target="_blank">${link}</a>`;
  document.getElementById("link").appendChild(linkEl);
}
</script>

</body>
</html>